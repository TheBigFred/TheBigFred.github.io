<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>fgeDoc's &ndash; diff & patch</title>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="./theme/stylesheet/style.min.css">
  <link rel="stylesheet" type="text/css" href="./theme/stylesheet/pygments.min.css">
  <link rel="stylesheet" type="text/css" href="./theme/stylesheet/font-awesome.min.css">
  <link href="http://fgedocs.boitemail.be/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="fgeDoc's Atom">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="index, follow">
<meta name="author" content="FGE">
<meta name="description" content="diff et patch sont deux outils en ligne de commande. diff, va vous permettre de comparer le contenu de deux fichiers ou dossiers et de …">
<meta name="keywords" content="cmd-line, GNU-Tools">
<meta property="og:site_name" content="fgeDoc's"/>
<meta property="og:title" content="diff & patch"/>
<meta property="og:description" content="diff et patch sont deux outils en ligne de commande. diff, va vous permettre de comparer le contenu de deux fichiers ou dossiers et de …"/>
<meta property="og:locale" content="fr_BE"/>
<meta property="og:url" content="./diff-patch.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2016-09-25 00:00:00+02:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="./author/fge.html">
<meta property="article:section" content="devtools"/>
<meta property="article:tag" content="cmd-line"/>
<meta property="article:tag" content="GNU-Tools"/>
<meta property="og:image" content=""></head>
<body>
  <aside>
    <div>
      <h1><a href=".">FGE Doc's</a></h1>
      <p>Sharing notes</p>
      <nav>
        <ul class="list">
          <li><a href=".">Home</a></li>
        </ul>
      </nav>
      <h2><a href="./categories.html"><span class="fa fa-folder-open-o"></span> <small>Catégories</small></a></h2>
      <nav>
	      <ul class="list">
          <li><a href="./category/devtools.html">devtools (5)</a></li>
          <li><a href="./category/linux.html">linux (4)</a></li>
        </ul>
      </nav>
      <h2><a href="./tags.html"><span class="fa fa-tags"></span> <small>Tags</small></a></h2>
      <nav>
        <ul class="list">          <li><a href="./tag/cmd-line.html">cmd-line (6)</a></li>
          <li><a href="./tag/gnu-tools.html">GNU-Tools (5)</a></li>
          <li><a href="./tag/xfce4.html">XFCE4 (1)</a></li>
          <li><a href="./tag/xorg.html">Xorg (2)</a></li>
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-linkedin" href="https://be.linkedin.com/in/frederic-gerard-32092754" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-rss" href="//fgedocs.boitemail.be/feeds/all.atom.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>
    <nav>
      <a href="."><span class="fa fa-home"> Home</a>
  - <span class="fa fa-folder-open-o" ></span> devtools
      <hr>
    </nav>

<article>
  <header>
    <h1 id="diff-patch">diff & patch</h1>
    <p>Publié le dim 25 septembre 2016 dans <a href="./category/devtools.html">devtools</a></p>
  </header>
  <div>
    <p>diff et patch sont deux outils en ligne de commande.</p>
<p>diff, va vous permettre de comparer le contenu de deux fichiers ou dossiers et de voir les ajouts et/ou suppressions qu'il y a eu entre chaque fichier.
Ce résultat peut être stocké dans un fichier, que l'on nomme patch.</p>
<p>La commande patch permet d'appliquer un <em>patch</em>. Le but est donc de pouvoir ré-appliquer une modification sur un fichier ou dossier en version original.</p>
<h2>diff</h2>
<ul>
<li><code>diff -q fichier1 fichier2</code> permet de savoir si les fichiers sont différents.</li>
<li><code>diff -s fichier1 fichier2</code> permet de savoir si les fichiers sont identiques.</li>
<li><code>diff -y fichier1 fichier2</code> affiche les deux fichiers côte à côte.</li>
<li><code>diff -u fichier1 fichier2</code> imprime (par défaut) 3 lignes qui entourent la différence.</li>
<li><code>diff -a fichier1 fichier2</code> traite les fichiers comme des fichiers textes.</li>
<li><code>diff --color=auto fichier1 fichier2</code> ajoute de la couleur au résultat.</li>
<li><code>diff -r dossier1 dossier2</code> permet de comparer deux dossiers récursivement.</li>
<li><code>diff -N dossier1 dossier2</code> traite les fichiers absents comme étant vides.</li>
</ul>
<p>Il y a évidement une multitude d'autres options que vous découvrirez dans <code>man diff</code>.</p>
<p><strong>Meld</strong>, <strong>Kdiff3</strong> et <strong>Kompare</strong> sont des versions graphiques de diff. Le premier est basé sur GTK, les deux autres sur Qt.</p>
<h2>Créer un patch</h2>
<p>Admettons que votre répertoire de travail est $HOME/projetX. Avant de le modifier, faite en une copie <code>cp -r $HOME/projetX $HOME/projetX.orig</code>.
Voici le fichier hello.c original :</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>Que vous modifiez en :</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello World !!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>La commande <code>diff -Naur projetX.orig projetX</code> donne comme résultat :</p>
<div class="highlight"><pre><span></span><span class="gh">diff -Naur projetX.orig/hello.c projetX/hello.c</span>
<span class="gd">--- projetX.orig/hello.c  2016-09-25 03:48:01.216191638 +0000</span>
<span class="gi">+++ projetX/hello.c 2016-09-25 03:48:12.059524697 +0000</span>
<span class="gu">@@ -1,6 +1,6 @@</span>
 #include &lt;stdio.h&gt;
 int main()
 {
<span class="gd">-    printf(&quot;Hello\n&quot;);</span>
<span class="gi">+    printf(&quot;Hello world !!!\n&quot;);</span>
     return 0;
 }
</pre></div>


<p>Pour créer le patch, il suffit de rediriger la commande diff dans un fichier : <code>diff -Naur projetX.orig projetX &gt; $HOME/bug1.patch</code></p>
<blockquote>
<p>Pour la suite supprimer le dossier <em>projectX</em> <code>rm -r $HOME/projetX</code> et renommer <em>projetX.orig</em> <code>mv projetX.orig projetX</code> (on applique le patch sur la version d'origine).</p>
</blockquote>
<h2>Appliquer un patch</h2>
<p>Placez vous dans le dossier parent de votre projet. La commande <code>patch -p0 &lt; $hOME/bug1.patch</code> appliquera votre patch sur le dossier <em>projetX</em>.</p>
<p>Si vous avez renommé, ou souhaitez appliquer le patch sur une copie du projet, appliquez la commande depuis le dossier du projet avec l'option <em>-p1</em>: <code>patch -p1 &lt; $HOME/bug1.patch</code>.</p>
<p>Cette option <em>-p1</em> permet à la commande patch d'enlever un niveau de dossier au chemin indiqué dans le fichier <em>.patch</em>.</p>
<blockquote>
<p>Il ne faut pas oublier que pour créer un patch, il faut conserver une copie non modifiée du projet. Ceci est grandement facilité en utilisant des outils de gestion de version comme git ou svn.</p>
</blockquote>
<h2>Est-ce vraiment utile tout cela ?</h2>
<p>Voici quelques exemples d'utilisation.</p>
<h3>Exemple 1</h3>
<p>Vous venez de modifier votre site web, votre modification porte sur plusieurs fichiers php, js, html et css. Soit vous transférez complètement la dernière version de votre site, soit uniquement les fichiers impactés.</p>
<p>Dans le premier cas, cela peu prendre un petit peu de temps. Dans le second cas, il faut veiller à ne pas oublier de fichiers.</p>
<p>Une autre solution est possible, créer un patch et appliquer ce patch sur le serveur. Le patch est de petite taille comparé à la totalité du site (transfert instantané), aucune modification n'est oubliée.</p>
<p>Ici, il faut soit un accès en ssh à votre serveur, soit une interface web qui permet d'appliquer un patch.</p>
<h3>Exemple 2</h3>
<p>Admettons que vous modifiez un fichier .c du kernel, le meilleur moyen pour diffuser ou conserver cette modification est un fichier <em>patch</em>.</p>
<p>Lorsque vous recevez un <em>patch</em>, vous pouvez l'éditer et voir les modifications qui seront apportées à l'arborescence.</p>
<p>Votre patch sera même peut être applicable sur les versions successives du kernel. En une commande vous pouvez ré-appliquer vos modifications. </p>
<p>Par contre si vous diffusez une archive complète du kernel contenant votre modification, comment faire pour intégrer votre modification au kernel suivant ou à une version sur laquelle d'autres patchs ont déjà été appliqués ?</p>
  </div>
  <header>
  </header>
  <div class="tag-cloud">
    <p>
      <span class="fa fa-tags" ></span> 
      <a href="./tag/cmd-line.html">cmd-line</a>
      <a href="./tag/gnu-tools.html">GNU-Tools</a>
    </p>
  </div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'fgedocs';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</article>

    <footer>
<p>
  &copy; FGE 2016 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "diff & patch",
  "headline": "diff & patch",
  "datePublished": "2016-09-25 00:00:00+02:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "FGE",
    "url": "./author/fge.html"
  },
  "image": "{{ SITEURL }}/{{ THEME_STATIC_DIR }}/img/profile.png",
  "url": "./diff-patch.html",
  "description": "diff et patch sont deux outils en ligne de commande. diff, va vous permettre de comparer le contenu de deux fichiers ou dossiers et de …"
}
</script></body>
</html>